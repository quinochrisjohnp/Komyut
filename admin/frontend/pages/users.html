<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Management</title>
  <link rel="stylesheet" href="./../css/style.css" />
</head>

<body>
  <div class="container">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="profile">
        <h2>Super Admin</h2>
      </div>
      <ul class="menu" id="menu">
        <li data-page="dashboard"><a href="dashboard.html">Dashboard</a></li>
        <li data-page="users" class="active"><a href="users.html">User Management</a></li>
        <li data-page="routes"><a href="routes.html">Route Management</a></li>
        <li data-page="notifications"><a href="notifications.html">Notifications Manager</a></li>
        <li data-page="feedback"><a href="feedback.html">Feedbacks & Reports</a></li>
        <li data-page="admin"><a href="admin.html">Admin Management</a></li>
        <li data-page="logs"><a href="logs.html">Activity Logs</a></li>
        <li data-page="logout"><a href="logout.html">Logout</a></li>
      </ul>
    </aside>

    <!-- Main Section -->
    <section id="page-users" class="page active-page">
      <div class="content-body">
        <h1>User Management</h1>

        <section class="users-page" data-page="users">

          <!-- Search -->
          <div class="users-header">
            <form>
              <div class="search-route">
                <input class="search-input-route" type="search" placeholder="Search">
                <button type="submit" class="search-submit-route">
                  <span class="search-icon-route material-symbols-outlined">search</span>
                </button>
              </div>
            </form>
          </div>

          <!-- Users Table -->
          <div class="users-card">
            <table class="users-table">
              <thead>
                <tr>
                  <th>User Name</th>
                  <th>Email</th>
                </tr>
              </thead>
              <tbody id="usersTbody">
                <tr>
                  <td colspan="2">Loading users...</td>
                </tr>
              </tbody>
            </table>
          </div>

        </section>
      </div>
    </section>
  </div>

  <!-- 🪝 Fetch users dynamically -->
  <script>
  document.addEventListener("DOMContentLoaded", async () => {
    const tbody = document.getElementById("usersTbody");

    try {
      // ✅ Use the correct endpoint name from your adminServer.js
      const response = await fetch("http://localhost:5002/api/clerk-users");
      if (!response.ok) throw new Error("Failed to fetch users");

      const data = await response.json();
      const users = data.users || [];

      tbody.innerHTML = ""; // Clear existing rows

      if (users.length === 0) {
        tbody.innerHTML = `<tr><td colspan="2">No users found.</td></tr>`;
      } else {
        users.forEach((user) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="col-name">${user.username || "(no username)"}</td>
            <td class="col-email">
              <a href="mailto:${user.email}">${user.email}</a>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }
    } catch (error) {
      console.error("Error loading users:", error);
      tbody.innerHTML = `<tr><td colspan="2">Error fetching users.</td></tr>`;
    }
  });
</script>

</body>
</html>
